{"version":3,"file":"index.js","names":[],"sources":["../../../../src/components/connect/strategies/index.ts"],"sourcesContent":["import type { ConnectHandlerOptions } from \"../types.ts\";\nimport type { ConnectionStrategy, StrategyConfig } from \"./core/types.ts\";\nimport { SameThreadStrategy } from \"./sameThread/index.ts\";\n\nexport type {\n  BaseConnectionConfig,\n  ConnectionEstablishData,\n  ConnectionStrategy,\n  RequestHandler,\n  StrategyConfig,\n  StrategyEvents,\n} from \"./core/types.ts\";\nexport { SameThreadStrategy } from \"./sameThread/index.ts\";\n\n/**\n * Creates a connection strategy based on the provided options.\n *\n * By default, uses SameThreadStrategy. When `isolateExecution: true` is\n * specified and worker_threads is available, uses WorkerThreadStrategy instead.\n */\nexport async function createStrategy(\n  config: StrategyConfig,\n  options: ConnectHandlerOptions,\n): Promise<ConnectionStrategy> {\n  if (options.isolateExecution) {\n    // Try to load worker thread strategy\n    try {\n      // Dynamic import to avoid bundling worker_threads in non-Node environments\n      const { WorkerThreadStrategy } = await import(\"./workerThread/index.ts\");\n      return new WorkerThreadStrategy(config);\n    } catch (err) {\n      throw new Error(\"Failed to load worker thread strategy\", { cause: err });\n    }\n  }\n\n  // TODO: Default to `WorkerThreadStrategy` if worker threads are available.\n  // Only make that change once we confirm that `WorkerThreadStrategy` is ready\n  // for primetime\n\n  return new SameThreadStrategy(config);\n}\n"],"mappings":";;;;;;;;;AAoBA,eAAsB,eACpB,QACA,SAC6B;AAC7B,KAAI,QAAQ,iBAEV,KAAI;EAEF,MAAM,EAAE,yBAAyB,MAAM,OAAO;AAC9C,SAAO,IAAI,qBAAqB,OAAO;UAChC,KAAK;AACZ,QAAM,IAAI,MAAM,yCAAyC,EAAE,OAAO,KAAK,CAAC;;AAQ5E,QAAO,IAAI,mBAAmB,OAAO"}